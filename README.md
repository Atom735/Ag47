# Рабочий проект

## Имспользуемые средства

[msys2](https://www.msys2.org/)

Библиотеки:
* libarchive
* libxml2

```bash
  pacman -S \
  mingw-w64-x86_64-gcc \
  mingw-w64-x86_64-gdb \
  mingw-w64-x86_64-make \
  mingw-w64-x86_64-libarchive \
  mingw-w64-x86_64-libxml2 \
  mingw-w64-x86_64-pcre2 \

```

Кароч, качаешь msys2, ставишь его, запускаешь внутри `mingw64.exe`.
След шагом в консоль mingw64 вводим команды для установки пакетов.
Для перестройки проекта перейти в папку с проектом, используя команду `cd`.
Находясь в папке проекта запукстить `mingw32-make`.
Для удобства просмотра и написания кода, советую пользоваться [Sublime Text Editor 3](https://www.sublimetext.com/)

## Файлы кода

Весь код хранится в папке `src`.
Программа состоит из одного объекта.

- __ag47_misc.c__
  Код общих функций обработки строк и указателей в файле
- __ag47_parse.c__
  Код оболочки парсинга дерева, и отбора файлов на парсинг. Проверка сигнатуры файла и отправка его обработки в другие парсеры происходит здесь.
- __ag47_parse_docx.c__
  Код парсинга только _docx_ файлов с инклинометрией (_doc_ файлы преобразуются программой `wordconv.exe`)
- __ag47_parse_las.c__
  Код парсинга _las_ файлов ГИС
- __ag47_parse_txt.c__
  Парсинг _txt_ файлов с инклинометрией
- __ag47_settings.c__
  Парсинг файла скрипта, и запуск обработки
- __ag47_settings.h__
  Все переменные кодов ошибок, а также структура сценариев
- __ag47_tbl_map_*.x__
  Файлы отображений символов из одной кодировки в Unicode
- __ag47_tbl_rus_a.x__
  Частота встречаемости русских букв в тексте
- __ag47_tbl_rus_b.x__
  Частота встречаемости русских пар букв в тексте
- __main.c__
  Самый главный файл, также точка входа в программу
- __ag47_arrays.c__
  Функции по работе со динамичными массивами (векторами) с разными типами наполнения, также функции сравнения и обработки строк (как векторов)
- __ag47_dbf.c__
  Парсинг _dbf_ файлов и изъятие нужных данных
- __ag47_fs.c__
  Работа с файловой системой, отображение файлов в память.
- __ag47_log.c__
  Фукнции логирования (записи отладочной информации в память)
- __ag47_map.c__
  Код связанный с кодировками
- __ag47_maps.x__
  Шаблон для кодировок и их отображений
- __ag47_maps_names.x__
  Шаблон для имён кодировок и их ID


## Файл сценария

Расширение файла __\*.ag47-script__

Файл начинается с заголовка, первый символ либо [BOM](https://ru.wikipedia.org/wiki/Маркер_последовательности_байтов),
либо `#` после которого указывается кодировка файла (прим. `#UTF-8`, `#.1251`).
Номера кодовых страниц можно найти на сайте [msdn](https://docs.microsoft.com/ru-ru/windows/win32/intl/code-page-identifiers)
Если не указано, парсер сам попытается угадать кодировку.

| ID Кодировки | Сокращённое название              | Полное название                          |
| ------------:| --------------------------------- | ---------------------------------------- |
| 855          | IBM855                            | OEM Cyrillic (primarily Russian)         |
| 866          | cp866                             | OEM Russian; Cyrillic (DOS)              |
| 1251         | windows-1251                      | ANSI Cyrillic; Cyrillic (Windows)        |
| 10007        | x-mac-cyrillic                    | Cyrillic (Mac)                           |
| 20866        | koi8-r                            | Russian (KOI8-R); Cyrillic (KOI8-R)      |
| 28595        | iso-8859-5                        | ISO 8859-5 Cyrillic                      |
| 1200         | utf-16                            | Unicode UTF-16, little endian byte order |
| 1201         | unicodeFFFE                       | Unicode UTF-16, big endian byte order    |
| 12000        | utf-32                            | Unicode UTF-32, little endian byte order |
| 12001        | utf-32BE                          | Unicode UTF-32, big endian byte order    |
| 65001        | utf-8                             | Unicode (UTF-8)                          |

### Общие сведения

* `//` - комментарий до конца строки
* `/*...*/` - блок комментарий

### Параметры сценария

Общая строка параметра выглядит как `ws name ws = ws value ws ;` где вместо `value` может быть следующие типы данных:
- __ARRAY OF VALUE__: `[ ws value ws , ... ]`
- __STRING__: `'{{RAW_DATA}}'`
- __CSTRING__: `"{{cstring}}"`
- __NUMBER__: `{{INT}}`
_ __BOOL__: `TRUE` или `FALSE`

По умолчанию открывается файл `.ag47-script`
Файл без строки `RUN` записывает в `.ag47.log` допустимые настройки

__Больше информации можно найти в комментариях файла с кодом__ `ag47_settings.h`

# Всё что ниже, не реализовано

* [ ] in
  массив всех папок, файлов, которые необходимо обработать

* [ ] out
  папка куда будут сохраняться конечные данные

# Стратегия развития



# Остальное не нуждается в реализации в данный момент


* [ ] `RUN=["."];` -
  путь к поиску файлов, начинает поиск и обработку используя все
  предыдущие настройки.

* [ ] `RESET;` -
  сбрось настроек к настройкам по умолчанию.

* [ ] `OUT_PATH=".ag47";` -
  указывает папку для сохранения файлов и отладочных данных, если папки не
  существует, то она будет создана.

* [ ] `OUT_RECREATE=FALSE;` -
  если указан `TRUE`, то папка будет пересоздана, т.е. внутри папки {{PATH_OUT}} всё почистится.

* [ ] `LAS_FORMAT=[".las",".las[0]",".las[1]"];` -
  указывает окончание для поиска _LAS_ файлов.

* [ ] `LAS_UPDATE=FALSE;` -
  разрешить модифицировать исходящие `LAS` файлы.

* [ ] `LAS_EOL=NULL;` -
  указвает конец строки для модифицированного файла, может принимать значения:
  `CR`, `LF`, `CRLF`,
  `NULL` - не изменять.

* [ ] `LAS_CP=".1251";` -
  указвает конечную кодировку для модифицированного файла, может принимать значения:
  `NULL` - не изменять.
  (другие значения в таблице кодировок)

| ID Кодировки | Сокращённое название              | Полное название                       |
| ------------:| --------------------------------- | ------------------------------------- |
| 855          | IBM855                            | OEM Cyrillic (primarily Russian)      |
| 866          | cp866                             | OEM Russian; Cyrillic (DOS)           |
| 1251         | windows-1251                      | ANSI Cyrillic; Cyrillic (Windows)     |
| 10007        | x-mac-cyrillic                    | Cyrillic (Mac)                        |
| 20866        | koi8-r                            | Russian (KOI8-R); Cyrillic (KOI8-R)   |
| 21866        | koi8-u                            | Ukrainian (KOI8-U); Cyrillic (KOI8-U) |
| 28595        | iso-8859-5                        | ISO 8859-5 Cyrillic                   |

* [ ] `LAS_LOG_DATA_PATH=".logs/las.log";` -
  путь к потсроению таблицы всех данных `LAS` файлов, если указать
  `LOG_LAS_DATA=NULL;`, то данные не будут сохранятся.

* [ ] `LAS_LOG_DATA_HEAD_FMT=["%(SECTION)|"];` -
  какие общие данне LAS файла будут записаны в таблицу всех данных `LAS` файлов.
* [ ] `LAS_LOG_DATA_LINE_FMT="%(SECTION)|";` -
  какие данне о каждой линии будут записаны в таблицу всех данных `LAS` файлов.

| Имя переменной FMT    | Описание                          | Пример вывода                         |
| --------------------- | --------------------------------- | ------------------------------------- |
| [x] `CODEPAGE_ID`     | Номер кодировки                   | `1251`                                |
| [x] `CODEPAGE`        | Сокращённое название кодировки    | `windows-1251`                        |
| [x] `CODEPAGE_FULL`   | Полное название кодировки         | `ANSI Cyrillic; Cyrillic (Windows)`   |
| [x] `CODEPAGE_A1`     | Количество очков кодировки        | `20594414`                            |
| [x] `CODEPAGE_A2`     | Количество очков кодировки        | `11217259`                            |
| [x] `CODEPAGES`       | Пройтись по всем кодировкам       | ---                                   |
| [x] `ENDOFLINE`       | Символ конца строки               | `CRLF`                                |
| [x] `ENDOFLINE_EX`    | Символ конца строки расширенное   | `CRLF (Windows)`                      |
| [x] `ORIGIN_PATH`     | Путь к оригиналу файла            | `F:\LAS\BK1.LAS`                      |
| [x] `NLINE`           | Номер строки                      | `13`                                  |
| [x] `SECTION`         | Символ секции                     | `V`                                   |
| [x] `SECTION_FULL`    | Полная стркоа секции              | `Version information`                 |
| [x] `S_MNEM`          | Мнемоника                         | `DFD`                                 |
| [x] `S_UNIT`          | Размерность                       | `K/M3`                                |
| [x] `S_DATA`          | Данные                            | `1200.0000`                           |
| [x] `S_DESC`          | Описание                          | `Mud Weight`                          |


* [ ] `INK_FORMAT=[".doc",".docx",".txt"];` -
  указывает окончания для поиска файлов с инклинометрией

* [ ] `ARCHIVES_FORMAT=[".zip",".rar"];` -
  формат файлов архивов в которых будет производится поиск




## Задачи
